FROM python:3.7-slim

ARG RELEASE
RUN apt-get update -y
RUN apt-get install curl gnupg -y

# Note: -k/--insecure cannot be used with curl; security compliance requires we verify certs
RUN curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
RUN curl https://packages.microsoft.com/config/debian/10/prod.list > /etc/apt/sources.list.d/mssql-release.list
RUN apt-get update -y
RUN apt-get upgrade -y
RUN apt-get install git -y
RUN apt-get install git gcc libffi-dev g++ unixodbc-dev -y
RUN pip3 install --upgrade pip
RUN pip3 install hdbcli azure-storage==0.36.0 azure_storage_logging azure-mgmt-storage azure-keyvault-secrets azure-identity prometheus_client retry pyodbc zeep

# download and install Python NW RFC connector package and set dynamic library load
# path override to be the anticipated nwrfcsdk install path so that if the user 
# does provide an RFC SDK .zip file to install, we will be able to successfully import
# the pyrfc module once the install has been done from the sapmon netweaver proivder code
ENV LD_LIBRARY_PATH=/var/opt/microsoft/sapmon/usrlibs/nwrfcsdk/lib
RUN curl --location --output pynwrfc-2.3.0-cp37-cp37m-linux_x86_64.whl https://github.com/SAP/PyRFC/releases/download/2.3.0/pynwrfc-2.3.0-cp37-cp37m-linux_x86_64.whl
RUN pip3 install pynwrfc-2.3.0-cp37-cp37m-linux_x86_64.whl

RUN ACCEPT_EULA=Y apt-get install msodbcsql17 -y

CMD []
